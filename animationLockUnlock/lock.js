let AllAnimUnlock = {
    anim0: {
        // originos
        v11: "translateX(calc(-0.8750000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.6750000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v12: "translateX(calc(-0.2916667 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.6750000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v13: "translateX(calc(0.2916667 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.6750000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v14: "translateX(calc(0.8750000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.6750000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v21: "translateX(calc(-0.8750000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.3750000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v22: "translateX(calc(-0.2916667 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.3750000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v23: "translateX(calc(0.2916667 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.3750000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v24: "translateX(calc(0.8750000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.3750000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v31: "translateX(calc(-0.8750000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.0750000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v32: "translateX(calc(-0.2916667 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.0750000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v33: "translateX(calc(0.2916667 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.0750000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v34: "translateX(calc(0.8750000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.0750000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v41: "translateX(calc(-0.8750000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.2250000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v42: "translateX(calc(-0.2916667 * var(--bg-widthPhone) * 1px)) translateY(calc(0.2250000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v43: "translateX(calc(0.2916667 * var(--bg-widthPhone) * 1px)) translateY(calc(0.2250000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v44: "translateX(calc(0.8750000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.2250000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v51: "translateX(calc(-0.8750000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.5250000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v52: "translateX(calc(-0.2916667 * var(--bg-widthPhone) * 1px)) translateY(calc(0.5250000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v53: "translateX(calc(0.2916667 * var(--bg-widthPhone) * 1px)) translateY(calc(0.5250000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v54: "translateX(calc(0.8750000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.5250000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v61: "translateX(calc(-0.8750000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.8250000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v62: "translateX(calc(-0.2916667 * var(--bg-widthPhone) * 1px)) translateY(calc(0.8250000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v63: "translateX(calc(0.2916667 * var(--bg-widthPhone) * 1px)) translateY(calc(0.8250000 * var(--bg-heightPhone) * 1px)) scale(4)",
        v64: "translateX(calc(0.8750000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.8250000 * var(--bg-heightPhone) * 1px)) scale(4)",
    },
    anim1: {
        // iOS, hyperos
        v11: "translateX(calc(-0.7000000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.4400000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v12: "translateX(calc(-0.2333333 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.4400000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v13: "translateX(calc(0.2333333 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.4400000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v14: "translateX(calc(0.7000000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.4400000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v21: "translateX(calc(-0.7000000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.2000000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v22: "translateX(calc(-0.2333333 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.2000000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v23: "translateX(calc(0.2333333 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.2000000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v24: "translateX(calc(0.7000000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.2000000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v31: "translateX(calc(-0.7000000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.0400000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v32: "translateX(calc(-0.2333333 * var(--bg-widthPhone) * 1px)) translateY(calc(0.0400000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v33: "translateX(calc(0.2333333 * var(--bg-widthPhone) * 1px)) translateY(calc(0.0400000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v34: "translateX(calc(0.7000000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.0400000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v41: "translateX(calc(-0.7000000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.2800000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v42: "translateX(calc(-0.2333333 * var(--bg-widthPhone) * 1px)) translateY(calc(0.2800000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v43: "translateX(calc(0.2333333 * var(--bg-widthPhone) * 1px)) translateY(calc(0.2800000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v44: "translateX(calc(0.7000000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.2800000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v51: "translateX(calc(-0.7000000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.5200000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v52: "translateX(calc(-0.2333333 * var(--bg-widthPhone) * 1px)) translateY(calc(0.5200000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v53: "translateX(calc(0.2333333 * var(--bg-widthPhone) * 1px)) translateY(calc(0.5200000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v54: "translateX(calc(0.7000000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.5200000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v61: "translateX(calc(-0.7000000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.7600000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v62: "translateX(calc(-0.2333333 * var(--bg-widthPhone) * 1px)) translateY(calc(0.7600000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v63: "translateX(calc(0.2333333 * var(--bg-widthPhone) * 1px)) translateY(calc(0.7600000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v64: "translateX(calc(0.7000000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.7600000 * var(--bg-heightPhone) * 1px)) scale(3)",
    },
    anim2: {
        // harmonyos next
        v11: "translateX(calc(0.1750000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.1100000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v12: "translateX(calc(0.0583333 * var(--bg-widthPhone) * 1px)) translateY(calc(0.1100000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v13: "translateX(calc(-0.0583333 * var(--bg-widthPhone) * 1px)) translateY(calc(0.1100000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v14: "translateX(calc(-0.1750000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.1100000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v21: "translateX(calc(0.1750000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.0500000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v22: "translateX(calc(0.0583333 * var(--bg-widthPhone) * 1px)) translateY(calc(0.0500000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v23: "translateX(calc(-0.0583333 * var(--bg-widthPhone) * 1px)) translateY(calc(0.0500000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v24: "translateX(calc(-0.1750000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.0500000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v31: "translateX(calc(0.1750000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.0100000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v32: "translateX(calc(0.0583333 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.0100000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v33: "translateX(calc(-0.0583333 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.0100000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v34: "translateX(calc(-0.1750000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.0100000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v41: "translateX(calc(0.1750000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.0700000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v42: "translateX(calc(0.0583333 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.0700000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v43: "translateX(calc(-0.0583333 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.0700000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v44: "translateX(calc(-0.1750000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.0700000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v51: "translateX(calc(0.1750000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.1300000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v52: "translateX(calc(0.0583333 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.1300000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v53: "translateX(calc(-0.0583333 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.1300000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v54: "translateX(calc(-0.1750000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.1300000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v61: "translateX(calc(0.1750000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.1900000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v62: "translateX(calc(0.0583333 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.1900000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v63: "translateX(calc(-0.0583333 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.1900000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
        v64: "translateX(calc(-0.1750000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.1900000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
    },

    anim3: {
        // coloros 15
        v11: "scale(1.8) translateX(-105px) translateY(-120px)",
        v12: "scale(2) translateX(-35px) translateY(-120px)",
        v13: "scale(2) translateX(35px) translateY(-120px)",
        v14: "scale(1.8) translateX(105px) translateY(-120px)", //4

        v21: "scale(2) translateX(-105px) translateY(-40px)",
        v22: "scale(2.4) translateX(-35px) translateY(-40px)",
        v23: "scale(2.4) translateX(35px) translateY(-40px)",
        v24: "scale(2) translateX(105px) translateY(-40px)", //8

        v31: "scale(2) translateX(-105px) translateY(40px)",
        v32: "scale(2.4) translateX(-35px) translateY(40px)",
        v33: "scale(2.4) translateX(35px) translateY(40px)",
        v34: "scale(2) translateX(105px) translateY(40px)", //12

        v41: "scale(1.8) translateX(-105px) translateY(120px)",
        v42: "scale(2) translateX(-35px) translateY(120px)",
        v43: "scale(2) translateX(35px) translateY(120px)",
        v44: "scale(1.8) translateX(105px) translateY(120px)", //16

        v51: "scale(1.8) translateX(-105px) translateY(200px)",
        v52: "scale(1.8) translateX(-35px) translateY(200px)",
        v53: "scale(1.8) translateX(35px) translateY(200px)",
        v54: "scale(1.8) translateX(105px) translateY(200px)", //20

        v61: "scale(1.8) translateX(-105px) translateY(280px)",
        v62: "scale(1.8) translateX(-35px) translateY(280px)",
        v63: "scale(1.8) translateX(35px) translateY(280px)",
        v64: "scale(1.8) translateX(105px) translateY(280px)", //20
    },
    anim4: {
        // one ui 7
        v11: "translateX(calc(-0.7500000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.6400000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v12: "translateX(calc(-0.2500000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.6400000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v13: "translateX(calc(0.2500000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.6400000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v14: "translateX(calc(0.7500000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.6400000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v21: "translateX(calc(-0.7500000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.4000000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v22: "translateX(calc(-0.2500000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.4000000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v23: "translateX(calc(0.2500000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.4000000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v24: "translateX(calc(0.7500000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.4000000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v31: "translateX(calc(-0.7500000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.1600000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v32: "translateX(calc(-0.2500000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.1600000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v33: "translateX(calc(0.2500000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.1600000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v34: "translateX(calc(0.7500000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.1600000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v41: "translateX(calc(-0.7500000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.0800000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v42: "translateX(calc(-0.2500000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.0800000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v43: "translateX(calc(0.2500000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.0800000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v44: "translateX(calc(0.7500000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.0800000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v51: "translateX(calc(-0.7500000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.3200000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v52: "translateX(calc(-0.2500000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.3200000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v53: "translateX(calc(0.2500000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.3200000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v54: "translateX(calc(0.7500000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.3200000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v61: "translateX(calc(-0.7500000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.5600000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v62: "translateX(calc(-0.2500000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.5600000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v63: "translateX(calc(0.2500000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.5600000 * var(--bg-heightPhone) * 1px)) scale(3)",
        v64: "translateX(calc(0.7500000 * var(--bg-widthPhone) * 1px)) translateY(calc(0.5600000 * var(--bg-heightPhone) * 1px)) scale(3)",
    },
};

let AllAnimUnlockForFavApp = {
    anim1: {
        // HyperOS, iOS, OriginOS
        favApp: "translateX(calc(0.0000000 * var(--bg-widthPhone) * 1px)) translateY(calc(1.1440000 * var(--bg-heightPhone) * 1px)) scale(3)",
    },
    anim2: {
        // HarmonyOS next
        favApp: "translateX(calc(0.0000000 * var(--bg-widthPhone) * 1px)) translateY(calc(-0.2860000 * var(--bg-heightPhone) * 1px)) scale(0.5)",
    },
    anim3: {
        // ColorOS 15
        favApp: "translateY(200px)",
    },
    anim4: {
        favApp: "translateY(calc(0.9440000 * var(--bg-heightPhone) * 1px)) scale(3)",
    },
};

transformUnlockAnim = AllAnimUnlock.anim1;
transformUnlockAnimForFavApp = AllAnimUnlockForFavApp.anim3;
durationForUnlockAnim = 600 * speed;
easingForUnlockAnim = "cubic-bezier(.35,1.29,.33,1)";
delayForUnlockAnim = 25 * speed;
let filterForUnlockAnim = "";

function createCustomUnlockAnim(
    scale = 0.6,
    name = "custom",
    nameFav = "custom",
    scalePosX = 50, // transform-origin
    scalePosY = 100, // transform-origin
    scaleFixed = scale // never mind lol :)
) {
    const WIDTH = 280;
    const HEIGHT = 617;

    const COLS = 4;
    const ROWS = 6;

    const x = 0.15;

    const startX = WIDTH * x;
    const endX = WIDTH * (1 - x);
    const startY = HEIGHT * 0.18;
    const endY = HEIGHT * 0.78;

    const stepX = (endX - startX) / (COLS - 1);
    const stepY = (endY - startY) / (ROWS - 1);

    const ox = (scalePosX / 100) * WIDTH;
    const oy = (scalePosY / 100) * HEIGHT;

    const gridAnim = {};
    const favAnim = {};

    for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
            const x = startX + c * stepX;
            const y = startY + r * stepY;

            const sx = ox + (x - ox) * scale;
            const sy = oy + (y - oy) * scale;

            const dx = (sx - x) / WIDTH;
            const dy = (sy - y) / HEIGHT;

            const key = `v${r + 1}${c + 1}`;

            gridAnim[key] =
                `translateX(calc(${dx.toFixed(7)} * var(--bg-widthPhone) * 1px)) ` +
                `translateY(calc(${dy.toFixed(7)} * var(--bg-heightPhone) * 1px)) ` +
                `scale(${scaleFixed})`;
        }
    }

    const favX = WIDTH / 2;
    const favY = endY + stepY * 1.6;

    const favSX = ox + (favX - ox) * scale;
    const favSY = oy + (favY - oy) * scale;

    const favDx = (favSX - favX) / WIDTH;
    const favDy = (favSY - favY) / HEIGHT;

    favAnim.favApp =
        `translateX(calc(${favDx.toFixed(7)} * var(--bg-widthPhone) * 1px)) ` +
        `translateY(calc(${favDy.toFixed(7)} * var(--bg-heightPhone) * 1px)) ` +
        `scale(${scale})`;

    AllAnimUnlock[name] = gridAnim;
    AllAnimUnlockForFavApp[nameFav] = favAnim;
}

function changeUnlockAnimStyle(style) {
    if (style === "ColorOS") {
        transformUnlockAnim = AllAnimUnlock.anim1;
        transformUnlockAnimForFavApp = AllAnimUnlockForFavApp.anim1;
        durationForUnlockAnim = 650 * speed;
        easingForUnlockAnim = "cubic-bezier(.3,1.25,.2,1)";
        delayForUnlockAnim = 17 * speed;
        filterForUnlockAnim = "";
        groupUnlockAnim = allGroupUnlockAnim.anim0;
    }
    if (style === "HyperOS") {
        transformUnlockAnim = AllAnimUnlock.anim1;
        transformUnlockAnimForFavApp = AllAnimUnlockForFavApp.anim1;
        durationForUnlockAnim = 520 * speed;
        easingForUnlockAnim = "cubic-bezier(.38,1.22,.27,1)";
        delayForUnlockAnim = 20 * speed;
        filterForUnlockAnim = `blur(${rootStyle.getPropertyValue("--bg-advancedBlur").toString()})`;
        groupUnlockAnim = allGroupUnlockAnim.anim0;
    }
    if (style === "OriginOS") {
        transformUnlockAnim = AllAnimUnlock.anim0;
        transformUnlockAnimForFavApp = AllAnimUnlockForFavApp.anim1;
        durationForUnlockAnim = 510 * speed;
        easingForUnlockAnim = "cubic-bezier(.38,1.16,.2,1)";
        delayForUnlockAnim = 20 * speed;
        filterForUnlockAnim = "";
        groupUnlockAnim = allGroupUnlockAnim.anim2;
    }
    if (style === "HarmonyOS") {
        transformUnlockAnim = AllAnimUnlock.anim2;
        transformUnlockAnimForFavApp = AllAnimUnlockForFavApp.anim2;
        durationForUnlockAnim = 500 * speed;
        easingForUnlockAnim = "cubic-bezier(0.4, 1.2, 0.3, 1)";
        delayForUnlockAnim = 30 * speed;
        filterForUnlockAnim = "";
        groupUnlockAnim = allGroupUnlockAnim.anim1;
    }
    if (style === "OneUI6") {
        transformUnlockAnim = AllAnimUnlock.anim4;
        transformUnlockAnimForFavApp = AllAnimUnlockForFavApp.anim4;
        durationForUnlockAnim = 450 * speed;
        easingForUnlockAnim = "ease";
        delayForUnlockAnim = 0;
        filterForUnlockAnim = "";
        groupUnlockAnim = allGroupUnlockAnim.anim4;
    }
    if (style === "OneUI7") {
        transformUnlockAnim = AllAnimUnlock.anim2;
        transformUnlockAnimForFavApp = AllAnimUnlockForFavApp.anim2;
        durationForUnlockAnim = 600 * speed;
        easingForUnlockAnim = "cubic-bezier(0.4, 1.2, 0.3, 1)";
        delayForUnlockAnim = 0;
        filterForUnlockAnim = "";
        groupUnlockAnim = allGroupUnlockAnim.anim4;
    }
    if (style === "customAnim") {
        transformUnlockAnim = AllAnimUnlock.custom;
        transformUnlockAnimForFavApp = AllAnimUnlockForFavApp.custom;
        durationForUnlockAnim = 510 * speed;
        easingForUnlockAnim = "cubic-bezier(.38,1.35,.2,1)";
        delayForUnlockAnim = 20 * speed;
        filterForUnlockAnim = `blur(calc(${rootStyle.getPropertyValue("--bg-advancedBlur").toString()} * 2))`;
        groupUnlockAnim = allGroupUnlockAnim.anim3;
    }
}

let allGroupUnlockAnim = {
    anim0: [
        {ids: ["v22", "v23", "v32", "v33"]},
        {ids: ["v21", "v24", "v31", "v34"]},
        {ids: ["v12", "v13", "v42", "v43"]},
        {ids: ["v11", "v14", "v41", "v44"]},
        {ids: ["v52", "v53"]},
        {ids: ["v51", "v54"]},
        {ids: ["v62", "v63"]},
        {ids: ["v61", "v64"]},
    ],
    anim1: [
        {ids: ["v22", "v23", "v32", "v33"]},
        {ids: ["v21", "v24", "v31", "v34"]},
        {ids: ["v12", "v13", "v42", "v43"]},
        {ids: ["v11", "v14", "v41", "v44"]},
        {ids: ["v52", "v53", "v51", "v54"]},
        {ids: []},
        {ids: ["v62", "v63"]},
        {ids: ["v61", "v64"]},
    ],
    anim2: [
        {ids: ["v22", "v23", "v32", "v33"]},
        {ids: ["v21", "v24", "v31", "v34", "v12", "v13", "v42", "v43"]},
        {ids: ["v11", "v14", "v41", "v44"]},
        {ids: ["v52", "v53"]},
        {ids: ["v51", "v54"]},
        {ids: ["v62", "v63"]},
        {ids: ["v61", "v64"]},
    ],
    anim3: [
        {ids: ["v12", "v13"]},
        {ids: ["v11", "v14", "v22", "v23"]},
        {ids: ["v21", "v24", "v32", "v33"]},
        {ids: ["v31", "v34", "v42", "v43"]},
        {ids: ["v41", "v44", "v52", "v53"]},
        {ids: ["v51", "v54", "v62", "v63"]},
        {ids: ["v61", "v64"]},
    ],
    anim4: [
        {
            ids: [
                "v11",
                "v12",
                "v13",
                "v14",
                "v21",
                "v22",
                "v23",
                "v24",
                "v31",
                "v32",
                "v33",
                "v34",
                "v41",
                "v42",
                "v43",
                "v44",
                "v51",
                "v52",
                "v53",
                "v54",
                "v61",
                "v62",
                "v63",
                "v64",
            ],
        },
    ],
};
let groupUnlockAnim = allGroupUnlockAnim.anim0;

function lockAnimScreen() {
    currentAppScreen.querySelectorAll(".iconApp").forEach((icon) => {
        const [row, col] = icon.style.gridArea.split("/").map((v) => parseInt(v));
        icon.style.transition = "all 0s";
        icon.style.transform = transformUnlockAnim[`v${row}${col}`];
        icon.style.opacity = "1";
        icon.style.zIndex = "0";
    });
    favApp.style.transition = "all 0s";
    favApp.style.transform = transformUnlockAnimForFavApp.favApp;
    favApp.style.opacity = "1";
    favApp.style.zIndex = "0";
}

function hiddenAllAppAndIcon() {
    document.querySelectorAll(".iconApp").forEach((icon) => {
        icon.style.transition = "all 0s";
        icon.style.opacity = "0";
    });
    favApp.style.transition = "all 0s";
    favApp.style.opacity = "0";
}

function showAllAppAndIcon() {
    document.querySelectorAll(".iconApp").forEach((icon) => {
        icon.style.transition = "";
        icon.style.opacity = "1";
    });
    favApp.style.transition = "";
    favApp.style.opacity = "1";
}

let timeOutHiddenAppForUnlockAnim = null;
let lastUnlockAnim = null;

async function unlockAnimWA(currentAppScreenTmp = currentAppScreen) {
    const wallpaperLockStyle = getComputedStyle(wallpaperLock);
    wallpaperHome.animate(
        [
            {
                background: `${wallpaperLockStyle.backgroundImage} no-repeat center/cover`,
                translate: wallpaperLockStyle.translate,
                borderRadius: wallpaperLockStyle.borderRadius,
                width: wallpaperLockStyle.width,
                height: wallpaperLockStyle.height,
                bottom: wallpaperLockStyle.bottom,
                scale: wallpaperLockStyle.scale,
                opacity: wallpaperLockStyle.opacity,
            },
            {
                background: "var(--bg-wallpaperHome) no-repeat center/cover",
                translate: "",
                borderRadius: "var(--bg-borderRadiusPhone)",
                width: "",
                height: "",
                bottom: "",
                scale: "",
                opacity: "",
            },
        ],
        {
            duration: 300 * speed,
            easing: "ease",
        }
    );

    if (currentOpeningElApp) {
        allAppScreen
        .animate([{scale: 0.9}, {scale: 1}], {
            duration: 400 * speed,
            easing: "ease",
            composite: "replace",
        })
        .effect.updateTiming({fill: "backwards"});
        return;
    }

    favApp.querySelectorAll(".iconApp").forEach((el) => {
        if (cancelIfAnimating(document.getElementById(el.dataset.app))) el.classList.remove("hidden");
    });

    groupUnlockAnim.forEach((group, groupIndex) => {
        const delay = groupIndex * delayForUnlockAnim;

        group.ids.forEach((id) => {
            const numericPart = id.slice(1);
            const [row, col] = numericPart.split("");
            const icon = currentAppScreenTmp.querySelector(`[style*="grid-area: ${row} / ${col}"]`);
            if (!icon) return;

            if (cancelIfAnimating(document.getElementById(icon.dataset.app))) icon.classList.remove("hidden");

            icon.style.pointerEvents = "none";
            icon.animate(
                [
                    {
                        opacity: 0,
                        transform: transformUnlockAnim[`v${row}${col}`],
                        zIndex: 0,
                        filter: filterForUnlockAnim,
                    },
                    {filter: filterForUnlockAnim, opacity: 1},
                    {transform: "none", zIndex: 1, filter: ""},
                ],
                {
                    duration: durationForUnlockAnim,
                    delay,
                    easing: easingForUnlockAnim,
                    composite: "replace",
                }
            ).effect.updateTiming({fill: "backwards"});
        });
    });

    // favApp
    const delay = (groupUnlockAnim.length - 1) * delayForUnlockAnim;

    Object.entries(transformUnlockAnimForFavApp).forEach(([key, value]) => {
        const el = document.getElementById(key);
        if (!el) return;

        el.animate([{opacity: 0, transform: value, zIndex: 0}, {opacity: 1}, {transform: "none", zIndex: 1}], {
            duration: durationForUnlockAnim,
            delay,
            easing: easingForUnlockAnim,
            composite: "replace",
        }).effect.updateTiming({fill: "backwards"});
    });

    lastUnlockAnim = document.getElementById("favApp").getAnimations()[
        document.getElementById("favApp").getAnimations().length - 1
    ];
    if (lastUnlockAnim) {
        await lastUnlockAnim.finished;

        if (lastUnlockAnim && lastUnlockAnim.playState !== "finished") {
            return;
        }

        updateAppPosNoRemove();
        document.querySelectorAll(".iconApp").forEach((icon) => {
            icon.style.pointerEvents = "";
        });
    }
}

// lock

document.getElementById("powerBtn").addEventListener("click", powerBtnEvent);

let isOn = true;
let isLock = false;

function powerBtnEvent() {
    if (!isOn) {
        powerOn();
    } else {
        powerOff();
        if (!isLock) showLockScreen();
    }
    hideAllAlerts();
    closeControlsCenter();
}

const fingerBtn = document.getElementById("fingerBtn");
const phoneFrame = document.getElementById("frame");

const wallpaperLockPre = document.querySelector(".imageForWallpaperLock.preview");
const wallpaperLockColorPre = wallpaperLockPre.closest(".wallpaper");

const wallpaperLockColor = document.getElementById("wallpaperLock");
const wallpaperLock = document.getElementById("imageForWallpaperLock");
const bottomBtn = document.querySelector(".bottomBtn");
const statusBar = document.getElementById("statusBar");
const lockContent = document.querySelector("#lockContent");
const lockContentDiv = document.querySelector("#lockContent div");

function applyStyle(el, styleObj) {
    if (!el || !styleObj) return;

    for (const [key, value] of Object.entries(styleObj)) {
        const cssKey = key.replace(/[A-Z]/g, (m) => "-" + m.toLowerCase());
        el.style.setProperty(cssKey, value);
    }
}

function applyWallpaperStyle(style) {
    applyStyle(wallpaperLock, style.wallpaperLock);
    applyStyle(bottomBtn, style.bottomBtn);
    applyStyle(statusBar, style.statusBar);
    applyStyle(lockContent, style.lockContent);
}

let originColorWallpaperLock = "#54126eff",
    darkerColorWallpaperLock = "#925252ff";

let allWallpaperOffStyle = {
    0: {
        wallpaperLock: {
            width: "calc(0.4px * var(--bg-widthPhone))",
            height: "calc(0.4px * var(--bg-widthPhone))",
            translate: "0 calc((1px * var(--bg-widthPhone) - 0.4px * var(--bg-widthPhone)) / 2)",
            borderRadius: "0px",
            bottom: "calc(100% - calc(0.4px * var(--bg-widthPhone)))",
        },
        bottomBtn: {opacity: "0"},
        statusBar: {opacity: "0"},
        lockContent: {
            translate: "0 calc((1px * var(--bg-widthPhone) - 0.5px * var(--bg-widthPhone)))",
            transform: "scale(0.9)",
        },
    },

    1: {
        wallpaperLock: {
            height: "calc(100% - 300px)",
            width: "calc(100% - 50px)",
            translate: "0 00%",
            borderRadius: "calc(0.06px * var(--bg-widthPhone))",
            scale: "0.95",
            bottom: "50px",
        },
        bottomBtn: {opacity: "0"},
        statusBar: {opacity: "0"},
        lockContent: {translate: "var(--bg-lockClockTranslate)", transform: "none"},
    },

    2: {
        wallpaperLock: {
            bottom: "0px",
            scale: "1.1",
            opacity: "0.8",
            height: "100%",
            width: "100%",
            translate: "none",
            borderRadius: "var(--bg-borderRadiusPhone)",
        },
        bottomBtn: {opacity: "0"},
        statusBar: {opacity: "0"},
        lockContent: {translate: "var(--bg-lockClockTranslate)", transform: "none"},
    },
};

let currentWallpaperOffStyle = allWallpaperOffStyle[1];

function wallpaperOffStyle() {
    wallpaperLockColor.style.background = "linear-gradient(#000000ff)";
    applyWallpaperStyle(currentWallpaperOffStyle);
}

let allWallpaperOnStyle = {
    1: {
        wallpaperLock: {
            height: "calc(100% - 300px)",
            width: "calc(100% - 50px)",
            translate: "0 00%",
            borderRadius: "calc(0.06px * var(--bg-widthPhone))",
            bottom: "50px",
            scale: "none",
        },
        bottomBtn: {opacity: "1"},
        statusBar: {opacity: "1"},
        lockContent: {translate: "var(--bg-lockClockTranslate)", transform: "none"},
    },

    2: {
        wallpaperLock: {
            bottom: "0px",
            height: "100%",
            width: "100%",
            translate: "none",
            borderRadius: "var(--bg-borderRadiusPhone)",
            scale: "none",
        },
        bottomBtn: {opacity: "1"},
        statusBar: {opacity: "1"},
        lockContent: {translate: "var(--bg-lockClockTranslate)", transform: "none"},
    },
};

let currentWallpaperOnStyle = allWallpaperOnStyle[localStorage.getItem("allWallpaperOnStyle") || "1"];

{
    const activeItem = document.querySelector(
        '#app_SettingsAppLockEditor [name="allWallpaperOnStyle"] .itemChild.active'
    );
    activeItem.classList.remove("active");

    const needActive = document.querySelector(
        `#app_SettingsAppLockEditor [name="allWallpaperOnStyle"] [data-allwallpaperonstyle="${
            localStorage.getItem("allWallpaperOnStyle") || "1"
        }"]`
    );
    needActive.classList.add("active");
}

wallpaperLockPre.animate([{}, currentWallpaperOnStyle.wallpaperLock], {
    fill: "forwards",
});

function wallpaperOnStyle() {
    const gradient =
        currentWallpaperOnStyle == allWallpaperOnStyle[1]
            ? `linear-gradient(${darkerColorWallpaperLock}, ${originColorWallpaperLock})`
            : `linear-gradient(#000, #000)`;
    wallpaperLockColor.style.background = gradient;
    applyWallpaperStyle(currentWallpaperOnStyle);
}

let doubleTapOnOff = 1;
function powerOff() {
    isOn = false;
    phone.classList.add("off");

    wallpaperOffStyle();

    hidePasswordScreen();

    // event listener
    if (doubleTapOnOff) lockScreen.addEventListener("click", powerOn2TapLockScreen);
    lockScreen.removeEventListener("click", powerOff2TapLockScreen);

    pauseVideoCanvas("wallpaperLock");

    // notif
    //removeScroll(document.querySelector(".stackWrapper"), document.querySelector(".stackContainer"));
    //stackWrapper.style.display = "none";
    //notifBtn.toggleClick = 1;
    //notifBtn.classList.remove("hidden");
}

function powerOn() {
    isOn = true;
    phone.classList.remove("off");

    wallpaperOnStyle();

    // event listener
    if (doubleTapOnOff) lockScreen.addEventListener("click", powerOff2TapLockScreen);
    lockScreen.removeEventListener("click", powerOn2TapLockScreen);

    resumeVideoCanvas("wallpaperLock");
}

const lockScreen = document.getElementById("lockScreen");
const statusClock = document.getElementById("statusClock");
const networkName = document.getElementById("networkName");

function fingerBtnPointerDown(e) {
    hiddenLockScreen();
    run_fingerprint_animation();
    fingerBtnAnim.style.pointerEvents = "all";
    e.preventDefault();
    e.stopPropagation();
    window.addEventListener("pointerup", fingerBtnPointerUp);
}
function fingerBtnPointerUp() {
    fingerBtnAnim.style.pointerEvents = "none";
    window.removeEventListener("pointerup", fingerBtnPointerUp);
}

function showLockScreen() {
    fingerBtn.addEventListener("pointerdown", fingerBtnPointerDown);

    allAppScreen.classList.add("hidden");
    lockScreen.style.display = "flex";
    allAppScreen.style.pointerEvents = "none";

    statusClock.style.display = "none";
    networkName.style.display = "flex";

    isLock = true;

    //containerNotif.innerHTML = "";

    // event listener
    lockScreen.addEventListener("pointerdown", pointerdown_scrollLockScreenToUnlock);
    window.addEventListener("pointermove", pointermove_scrollLockScreenToUnlock);
    window.addEventListener("pointerup", pointerup_scrollLockScreenToUnlock);
    run_fadein_animation();

    containerNotif.style.display = "none";

    islands.classList.add("Ihidden");

    if (allAppScreen.classList.contains("scaleForEdit")) allAppScreen.classList.remove("scaleForEdit");

    if (dragTarget) pointerUpIconWhileDragIconNoAnim();

    return;
    const wallpaperLockStyle = getComputedStyle(wallpaperHome);
    wallpaperLock.animate(
        [
            {
                background: `${wallpaperLockStyle.backgroundImage} no-repeat center/cover`,
                translate: wallpaperLockStyle.translate,
                borderRadius: wallpaperLockStyle.borderRadius,
                width: wallpaperLockStyle.width,
                height: wallpaperLockStyle.height,
                bottom: wallpaperLockStyle.bottom,
                scale: wallpaperLockStyle.scale,
            },
            {
                background: "",
                translate: "",
                borderRadius: "",
                width: "",
                height: "",
                bottom: "",
                scale: "",
            },
        ],
        {
            duration: 300 * speed,
            easing: "ease",
        }
    );
}

function hiddenLockScreen() {
    fingerBtn.removeEventListener("pointerdown", hiddenLockScreen);

    allAppScreen.classList.remove("hidden");
    allAppScreen.style.pointerEvents = lockScreen.style.display = "";
    unlockAnimWA();

    statusClock.style.display = networkName.style.display = "";

    isLock = false;
    if (!isOn) {
        powerOn();
        isOn = true;
    }

    hidePasswordScreen();
    //removeScroll(document.querySelector(".stackWrapper"), document.querySelector(".stackContainer"));

    // event listener
    lockScreen.removeEventListener("pointerdown", pointerdown_scrollLockScreenToUnlock);
    window.removeEventListener("pointermove", pointermove_scrollLockScreenToUnlock);
    window.removeEventListener("pointerup", pointerup_scrollLockScreenToUnlock);

    containerNotif.style.display = "";

    islands.classList.remove("Ihidden");

    pauseVideoCanvas("wallpaperLock");
}

// nhấn đúp -> sáng/tắt màn
let powerOn2TapLockScreenClickTime = 0;
function powerOn2TapLockScreen() {
    const currentTime = Date.now();
    const tapInterval = currentTime - powerOn2TapLockScreenClickTime;

    if (tapInterval < 400 && tapInterval > 0) {
        powerOn();
    }

    powerOn2TapLockScreenClickTime = currentTime;
}
let powerOff2TapLockScreenClickTime = 0;
function powerOff2TapLockScreen(e) {
    if (passwordScreen.classList.contains("open") || e.target.closest(".stackContainer")) return;
    const currentTime = Date.now();
    const tapInterval = currentTime - powerOff2TapLockScreenClickTime;

    if (tapInterval < 400 && tapInterval > 0) {
        powerOff();
    }

    powerOff2TapLockScreenClickTime = currentTime;
}

// scroll lockScreen on  up to hiddenLockScreen()
const scaleForOff = document.getElementById("scaleForOff");

let startY_lock = 0;
let currentY_lock = 0;
let lastY_lock = 0;
let lastTime_lock = 0;
let velocity_lock = 0;
let isDragging_lock = false;

function pointerdown_scrollLockScreenToUnlock(e) {
    if (!isOn || isOpened_pw || e.target.closest(".stackContainer")) return;
    startY_lock = e.clientY;
    currentY_lock = startY_lock;
    lastY_lock = startY_lock;
    lastTime_lock = Date.now();
    velocity_lock = 0;
    isDragging_lock = true;
    scaleForOff.style.transition = "transform 0.1s";
    e.preventDefault();
}

function pointermove_scrollLockScreenToUnlock(e) {
    if (!isDragging_lock) return;

    currentY_lock = e.clientY;
    let now = Date.now();

    // Tính vận tốc tại 100ms cuối
    let dt = now - lastTime_lock;
    if (dt > 0) {
        velocity_lock = (currentY_lock - lastY_lock) / dt; // px/ms
        lastY_lock = currentY_lock;
        lastTime_lock = now;
    }

    // Giới hạn chỉ vuốt lên (deltaY âm)
    let deltaY = currentY_lock - startY_lock;
    if (deltaY > 0) deltaY = 0;

    let scaleValue = 1 + deltaY / 2000;
    if (scaleValue < 0.9) scaleValue = 0.9;

    scaleForOff.style.transform = `scale(${scaleValue})`;
    e.preventDefault();
}

function pointerup_scrollLockScreenToUnlock(e) {
    if (!isDragging_lock) return;
    isDragging_lock = false;
    scaleForOff.style.transition = "";

    let deltaY = currentY_lock - startY_lock;

    // velocity_lock âm nghĩa là vuốt lên, ta lấy trị tuyệt đối để so sánh tốc độ
    let speed = Math.abs(velocity_lock);

    // Điều kiện: đủ cao (vuốt lên > 80px) và đủ nhanh (trên 0.5 px/ms)
    if (deltaY < -80 && speed > 0.5) {
        scaleForOff.style.transform = "";
        showPasswordScreen(hiddenLockScreen);
    } else {
        scaleForOff.style.transform = "";
    }
}

// ==== notif btn ====
//const notifBtn = document.querySelector(".notifBtn");
//notifBtn.toggleClick = 0;
//notifBtn.clickEvent = function (e) {
//    if (notifBtn.toggleClick) {
//        addScrollScript(document.querySelector(".stackWrapper"), document.querySelector(".stackContainer"), (y) => {
//            updateStack(containerLockNotif);
//            if (y < -60) lockContentDiv.style.transform = `translate(0px, ${y + 60}px)`;
//        });
//        stackWrapper.style.display = "";
//        runFor(500, () => {
//            updateStack(containerLockNotif);
//        });
//        e.target.classList.add("hidden");
//    } else {
//        removeScroll(document.querySelector(".stackWrapper"), document.querySelector(".stackContainer"));
//        stackWrapper.style.display = "none";
//        e.target.classList.remove("hidden");
//    }
//    notifBtn.toggleClick = !notifBtn.toggleClick;
//};
//notifBtn.addEventListener("click", notifBtn.clickEvent);
